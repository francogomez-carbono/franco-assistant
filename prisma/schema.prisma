generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- ESTADÍSTICAS Y RACHAS (Hardcore Mode) ---
model UserStats {
  id        Int @id @default(autoincrement())
  
  // XP y Nivel por Pilar
  xpPlata    Int @default(0)
  lvlPlata   Int @default(1)
  
  xpPensar   Int @default(0)
  lvlPensar  Int @default(1)
  
  xpFisico   Int @default(0)
  lvlFisico  Int @default(1)
  
  xpSocial   Int @default(0)
  lvlSocial  Int @default(1)

  // RACHAS (Nuevo) - Guardamos fecha de última acción para calcular castigos
  rachaPlata      Int      @default(0)
  lastPlata       DateTime @default(now())
  
  rachaPensar     Int      @default(0)
  lastPensar      DateTime @default(now())
  
  rachaFisico     Int      @default(0)
  lastFisico      DateTime @default(now())
  
  rachaSocial     Int      @default(0)
  lastSocial      DateTime @default(now())
}

// --- MODULO ANTI-ADICCIONES (Nuevo) ---
model Addiction {
  id          Int      @id @default(autoincrement())
  nombre      String   // Ej: "Porno", "Azúcar", "Cigarrillo"
  inicio      DateTime @default(now()) // Cuándo empezaste a dejarlo
  ultimoRelapso DateTime @default(now()) // Última vez que caíste
  recordHoras Float    @default(0) // Tu mejor racha histórica en horas
  recaidas    Int      @default(0)
}

// --- LOGS (Con soporte para "Drill Down") ---
model LogCiclo {
  id          Int       @id @default(autoincrement())
  tarea       String    // Ej: "Entrenamiento de Boxing"
  pilar       Pilar
  inicio      DateTime  @default(now())
  fin         DateTime?
  estado      EstadoCiclo @default(EN_PROGRESO)
  resultado   String?
  xpGanada    Int       @default(0)
  actividad   String?   // Nuevo: Para agrupar (Ej: "BOXING", "CODING")
}

// ... (El resto de tablas LogEstado, LogConsumo, etc. quedan igual, no hace falta tocarlas)
model LogEstado {
  id            Int      @id @default(autoincrement())
  timestamp     DateTime @default(now())
  energia       Int?     
  concentracion Int?     
  inputUsuario  String?  
  notasIA       String?  
  xpGanada      Int      @default(0) 
}

model LogHabito {
  id          Int      @id @default(autoincrement())
  nombre      String
  timestamp   DateTime @default(now())
  estado      EstadoHabito
  snoozeCount Int      @default(0)
  xpGanada    Int      @default(0) 
}

model LogConsumo {
  id          Int      @id @default(autoincrement())
  timestamp   DateTime @default(now())
  tipo        TipoConsumo
  descripcion String
  cantidad    Float?   
  xpGanada    Int      @default(0)
}

model LogIdea {
  id        Int      @id @default(autoincrement())
  timestamp DateTime @default(now())
  idea      String
  tags      String?
  xpGanada  Int      @default(0)
}

model LogSocial {
  id          Int      @id @default(autoincrement())
  timestamp   DateTime @default(now())
  tipo        String
  duracion    Int?
  valoracion  Int?
  xpGanada    Int      @default(0) 
}

// ENUMS
enum Pilar {
  PLATA
  PENSAR
  FISICO
  SOCIAL
}

enum EstadoCiclo {
  EN_PROGRESO
  COMPLETADO
  BURNOUT
  INTERRUMPIDO
}

enum EstadoHabito {
  HECHO
  POSPUESTO
  SKIPPED
}

enum TipoConsumo {
  COMIDA
  LIQUIDO
  AYUNO
  SUENO
}