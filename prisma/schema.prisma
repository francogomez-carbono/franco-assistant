cat <<EOF > prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// üë§ USUARIO
model User {
  id         String   @id @default(cuid())
  telegramId String   @unique
  createdAt  DateTime @default(now())

  stats        UserStats? 
  addictions   Addiction[]
  logsCiclo    LogCiclo[]
  logsEstado   LogEstado[]
  logsHabito   LogHabito[]
  logsConsumo  LogConsumo[]
  logsSocial   LogSocial[]
  logsIdea     LogIdea[]
  questPresets QuestPreset[]
  
  // RELACIONES FINANCIERAS Y DOPAMINA
  dopamineLogs DopamineLog[]
  financials   FinancialTransaction[]
}

// üõ°Ô∏è ESCUDO DE DOPAMINA
model DopamineLog {
  id        String   @id @default(cuid())
  fecha     DateTime @default(now())
  motivo    String?  
  userId    String
  user      User     @relation(fields: [userId], references: [id])
}

// üí∞ FINANZAS
model FinancialTransaction {
  id          String          @id @default(cuid())
  timestamp   DateTime        @default(now())
  amount      Float           
  type        TransactionType 
  category    String          
  description String?         
  
  userId      String
  user        User            @relation(fields: [userId], references: [id])
}

// üìä ESTAD√çSTICAS
model UserStats {
  id         String   @id @default(cuid())
  
  xpPlata    Int      @default(0)
  lvlPlata   Int      @default(1)
  xpPensar   Int      @default(0)
  lvlPensar  Int      @default(1)
  xpFisico   Int      @default(0)
  lvlFisico  Int      @default(1)
  xpSocial   Int      @default(0)
  lvlSocial  Int      @default(1)

  rachaPlata  Int      @default(0)
  lastPlata   DateTime @default(now())
  rachaPensar Int      @default(0)
  lastPensar  DateTime @default(now())
  rachaFisico Int      @default(0)
  lastFisico  DateTime @default(now())
  rachaSocial Int      @default(0)
  lastSocial  DateTime @default(now())

  userId     String   @unique
  user       User     @relation(fields: [userId], references: [id])
}

model Addiction {
  id            String   @id @default(cuid())
  nombre        String   
  inicio        DateTime @default(now()) 
  ultimoRelapso DateTime @default(now()) 
  recordHoras   Float    @default(0) 
  recaidas      Int      @default(0)
  userId        String
  user          User     @relation(fields: [userId], references: [id])
}

model LogCiclo {
  id          String   @id @default(cuid())
  tarea       String   
  pilar       Pilar
  inicio      DateTime @default(now())
  fin         DateTime?
  estado      EstadoCiclo @default(EN_PROGRESO)
  resultado   String?
  xpGanada    Int      @default(0)
  actividad   String?  
  userId      String
  user        User     @relation(fields: [userId], references: [id])
}

model LogEstado {
  id            String   @id @default(cuid())
  timestamp     DateTime @default(now())
  energia       Int?     
  concentracion Int?     
  inputUsuario  String?  
  notasIA       String?  
  xpGanada      Int      @default(0)
  userId        String
  user          User     @relation(fields: [userId], references: [id])
}

model LogHabito {
  id          String   @id @default(cuid())
  nombre      String
  timestamp   DateTime @default(now())
  estado      EstadoHabito
  snoozeCount Int      @default(0)
  xpGanada    Int      @default(0)
  userId      String
  user        User     @relation(fields: [userId], references: [id])
}

model LogConsumo {
  id          String   @id @default(cuid())
  timestamp   DateTime @default(now())
  tipo        TipoConsumo
  descripcion String
  cantidad    Float?   
  xpGanada    Int      @default(0)
  userId      String
  user        User     @relation(fields: [userId], references: [id])
}

model LogIdea {
  id        String   @id @default(cuid())
  timestamp DateTime @default(now())
  idea      String
  tags      String?
  xpGanada  Int      @default(0)
  userId    String
  user      User     @relation(fields: [userId], references: [id])
}

model LogSocial {
  id         String   @id @default(cuid())
  timestamp  DateTime @default(now())
  tipo       String
  persona    String?
  actividad  String?
  duracion   Int?
  valoracion Int?
  xpGanada   Int      @default(0)
  userId     String
  user       User     @relation(fields: [userId], references: [id])
}

model QuestPreset {
  id        String   @id @default(cuid())
  title     String
  xp        Int
  pilar     Pilar
  userId    String
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId, pilar])
}

enum Pilar {
  PLATA
  PENSAR
  FISICO
  SOCIAL
}
enum EstadoCiclo {
  EN_PROGRESO
  COMPLETADO
  BURNOUT
  INTERRUMPIDO
}
enum EstadoHabito {
  HECHO
  POSPUESTO
  SKIPPED
}
enum TipoConsumo {
  COMIDA
  LIQUIDO
  AYUNO
  SUENO
}
enum TransactionType {
  INGRESO
  GASTO
}
EOF